{"version":3,"sources":["../../src/lib/screen.js"],"names":[],"mappings":"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","file":"screen.js","sourcesContent":["/*\n * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,\n * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\n * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,\n * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING\n * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\n'use strict';\n\nvar _ = require('lodash');\nvar blessed = require('blessed');\nvar cmdWindow = require('./commandWindow')();\nvar stackWindow = require('./stackWindow')();\nvar watchWindow = require('./watchWindow')();\nvar messageWindow = require('./messageWindow')();\nvar jsonTree = require('./jsonTree');\n\nvar options = {\n  scrollable: true,\n  alwaysScroll: true,\n  top: 'center',\n  left: 'center',\n  width: '100%',\n  height: '100%',\n  content: '',\n  tags: true,\n  border: {\n    type: 'line'\n  },\n  style: {\n    fg: 'white',\n    bg: 'black',\n    border: {\n      fg: '#f0f0f0'\n    },\n  },\n  grabKeys: true\n};\n\nvar treeOptions = {\n  top: 'center',\n  width: '98%',\n  height: '95%',\n  selectedFg: 'white',\n  selectedBg: 'blue',\n  fg: 'white',\n  keys: true,\n  vi: true,\n  grabKeys: true\n};\n\n\nmodule.exports = function() {\n  var scr;\n  var box;\n  var currentContext;\n  var selected = 10;\n  var targetScroll = 0;\n\n  // keep target scroll against same file??\n  /*\n  var isVisible = function() {\n    // don't rescroll if visible\n  }\n  */\n\n  var renderBreakpoints = function renderBreakpoints(context) {\n    var scriptId = context.bp.callFrames[0].location.scriptId;\n    _.each(context.breakpoints, function(breakpoint) {\n      _.each(breakpoint.locations, function(location) {\n        if (location.scriptId === scriptId) {\n          var line = box.getLine(location.lineNumber);\n          line = '{red-bg}' + line + '{/red-bg}';\n          box.setLine(location.lineNumber, line);\n        }\n      });\n    });\n  };\n\n\n\n  var doRender = function doRender(direction, context) {\n    var line;\n    var lines = box.getLines().length;\n    var windowLines = box.height;\n    var scrollPos = box.getScroll();\n    var targetLine;\n    var scrollFudge = 10;\n\n    box.setContent(currentContext.source);\n\n    if (direction > 0) {\n      if (selected < lines - 1) {\n        selected = selected + direction;\n      }\n      if (selected >= windowLines - 2) {\n        box.scroll(1);\n      }\n    }\n    if (direction < 0) {\n      if (selected > 0) {\n        selected = selected + direction;\n      }\n      if (scrollPos > 0) {\n        box.scroll(-1);\n      }\n    }\n    if (direction === 0) {\n      targetLine = context.bp.callFrames[0].location.lineNumber;\n      if (targetLine > windowLines) {\n        var screens = Math.floor(targetLine / windowLines);\n        targetScroll = ((screens + 1) * windowLines) - scrollFudge;\n        selected = targetScroll + 10;\n        box.scroll(targetScroll);\n      }\n    }\n\n    line = box.getLine(currentContext.lineNumber);\n    line = '{green-bg}' + line + '{/green-bg}';\n    box.setLine(currentContext.lineNumber, line);\n\n    line = box.getLine(selected);\n    if (line.length > 0) {\n      line = '{blue-bg}' + line + '{/blue-bg}';\n    }\n    else {\n      line = '{blue-bg} {/blue-bg}';\n    }\n\n    renderBreakpoints(context);\n    box.setLine(selected, line);\n    scr.render();\n  };\n\n\n  \n  var move = function move(direction) {\n    doRender(direction, currentContext);\n  };\n\n\n\n  var start = function start(handler) {\n    scr = blessed.screen({smartCSR: true,\n                          fullUnicode: true,\n                          grabKeys: true,\n                          warnings: true});\n    scr.title = 'debugger';\n\n    box = blessed.box(options);\n    scr.append(box);\n    scr.key(['q', 'C-c'], function() {\n      return process.exit(0);\n    });\n\n    scr.key(['n'], function() {\n      handler('step');\n    });\n\n    scr.key(['r'], function() {\n      handler('resume');\n    });\n\n    scr.key(['j'], function() {\n      move(1);\n    });\n\n    scr.key(['k'], function() {\n      move(-1);\n    });\n\n    scr.key([':'], function() {\n      cmdWindow.open(scr, function(command) {\n        handler(command, selected);\n      });\n    });\n\n    box.focus();\n    scr.render();\n  };\n\n\n  var error = function error(errMsg) {\n    box.setContent(errMsg);\n    scr.render();\n  };\n\n\n  var render = function render(context) {\n    currentContext = context;\n    stackWindow.open(scr, context.bp);\n    watchWindow.open(scr, context.bp);\n    doRender(0, context);\n  };\n\n\n\n  var evalResult = function evalResult(err, result) {\n    var tree;\n\n    if (err) {\n      messageWindow.open(scr, err);\n      //watchWindow.setContent(scr, err);\n    }\n    else {\n      if (result.type === 'object') {\n        //messageWindow.open(scr, '');\n        treeOptions.parent = watchWindow.get();\n        tree = jsonTree(scr, treeOptions, result.value, 'eval');\n        scr.render();\n      }\n      else {\n        watchWindow.setContent(scr, result.value);\n      }\n    }\n  };\n\n\n\n  return {\n    start: start,\n    render: render,\n    evalResult: evalResult,\n    error: error\n  };\n};\n\n"]}