{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["Error.stackTraceLimit = Infinity\nimport 'babel-polyfill'\nimport 'source-map-support/register'\nimport fs from 'fs'\nimport path from 'path'\nimport React from 'react'\nimport {Provider, connect} from 'react-redux'\nimport {render} from 'react-blessed'\nimport portly from 'portly'\nimport createStore from './store/create'\nimport createScreen from './screen'\nimport config from './config'\nimport {\n  Console, Sources, Controls, Cog, Settings, Tabs\n} from './containers'\nimport createDebugger from './lib/debug'\nimport {\n  error,\n  receiveCallstack,\n  receiveBreakpoints,\n  receiveSource,\n  receiveSources,\n  selectFile,\n  selectFrame,\n  pause\n} from './actions'\n\nconst userSettings = path.join(__dirname, 'config', 'user-settings.json')\nconsole.log(userSettings)\nconst defaultCfg = {tooltips: true, layout: 'normal'}\n\nconst userCfg = (fs.existsSync(userSettings))\n  ? {...defaultCfg, ...require(userSettings)}\n  : {...defaultCfg}\n\nuserCfg.layout = config.layouts[userCfg.layout]\n\nconst store = createStore({\n  tab: 'sources',\n  panel: 'editor',\n  ...userCfg\n})\n\nconst {dispatch} = store\n\nexport const debug = createDebugger()\n\nexport default async (pid) => {\n  const debugPort = 5858\n\n  if (pid) {\n    try {\n      process.kill(pid, 'SIGUSR1')\n    } catch (e) {\n      console.log('Warning unable to locate supplied pid ', pid)\n    }\n  }\n\n  let screen = createScreen(store)\n\n  dispatch(receiveSource('Waiting for port debug port ' + debugPort))\n\n  portly(debugPort).then(portPid => {\n    const dbg = debug.start(debugPort, (err, callstack) => {\n      if (err) {\n        return dispatch(error(err))\n      }\n      dispatch(receiveCallstack(callstack))\n\n      debug.scripts((err, scripts) => {\n        if (err) {\n          return dispatch(error(err))\n        }\n        dispatch(receiveSources(scripts))\n        if (callstack) {\n          dispatch(pause())\n          dispatch(selectFrame(0))\n          return\n        }\n        const {name} = (scripts.find(s => s.name[0] === '/') || scripts[0])\n        dispatch(selectFile(name))\n      })\n\n      debug.breakpoints((err, {breakpoints}) => {\n        if (err) { return console.error(err) }\n        receiveBreakpoints(breakpoints)\n      })\n    })\n\n    dbg.on('event', ({event, body}) => {\n      if (event !== 'break') { return }\n      const {sourceLine: lineNumber, script: {id: scriptId}} = body\n      dispatch(selectFile({scriptId, lineNumber}))\n      debug.callstack((err, callstack) => {\n        if (err) {\n          return dispatch(error(err))\n        }\n        if (!callstack) { return }\n        dispatch(receiveCallstack(callstack))\n        dispatch(pause())\n        dispatch(selectFrame(0))\n      })\n    })\n  })\n\n  let Devtools = ({layout, tab, panel}) => {\n    return (\n      <element>\n        <Tabs />\n        {tab === 'sources' && <Sources/>}\n        {tab === 'console' && <Console/>}\n        <Cog {...layout.cog} active={panel === 'settings'}/>\n        {panel === 'settings' && <Settings focused={panel === 'settings'}/>}\n        <Controls {...layout.controls}/>\n      </element>\n    )\n  }\n\n  Devtools = connect(({layout, tab, panel}) => ({layout, tab, panel}))(Devtools)\n\n  return render(<Provider store={store}><Devtools/></Provider>, screen)\n}\n"]}