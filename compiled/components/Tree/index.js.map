{"version":3,"sources":["../../../src/components/Tree/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react'\nimport functional from 'react-functional'\n\n/* eslint-disable react/no-unknown-property */\n/* eslint-disable react/prop-types */\n\nconst noop = () => {}\n\nconst Tree = (props, cmp) => {\n  let selected = 0\n  const {\n    items: tree, onExpand = noop, onContract = noop,\n    onSelect = noop, onSelectItem = noop, item,\n    indentation, labelling, selectOverride\n  } = props\n\n  let {items, map} = traverse(tree, {indentation, labelling})\n\n  if (item && !cmp.$$forcingUpdate$$) {\n    let index = map.indexOf(item)\n    if (index < 0) {\n      const parent = map.find(function locate (o) {\n        let found = o === item && o\n        if (!found) {\n          found = o.value && Object.values(o.value).find(locate)\n        }\n        if (found) {\n          found.options = found.options || {}\n          if (!found.options.expanded) {\n            found.options.expanded = true\n            found.options.autoexpanded = true\n          }\n        }\n        return found\n      })\n      if (parent) {\n        parent.options = parent.options || {}\n        if (!parent.options.expanded) {\n          parent.options.expanded = true\n          parent.options.autoexpanded = true\n        }\n      }\n\n      map\n        .filter(p => p !== parent)\n        .forEach(function reset (o) {\n          if (o.options && o.options.expanded && o.options.autoexpanded) {\n            delete o.options.autoexpanded\n            o.options.expanded = false\n            if (o.value) Object.values(o.value).forEach(reset)\n          }\n        })\n\n      const retrav = traverse(tree, {indentation, labelling})\n      map = retrav.map\n      items = retrav.items\n      if (item.data && item.data.path) {\n        index = map.findIndex(o => {\n          if (!o.data) return\n          return o.data.path === item.data.path\n        })\n      }\n    }\n\n    if (index > -1) {\n      selected = index\n    }\n  }\n\n  if (cmp.$$forcingUpdate$$) {\n    selected = cmp.$$index$$\n  }\n\n  return (\n    <list\n      {...props}\n      keys\n      mouse\n      scrollbar\n      inputOnFocused\n      items={items}\n      selected={selected}\n      onSelectItem={selectOverride ? onSelectItem : noop}\n      onSelect={selectOverride ? onSelect : (c, index) => {\n        const {options = {}, value} = map[index]\n        if (!map[index].options) map[index].options = options\n\n        if (Object(value) !== value || options.terminate) {\n          onSelect(map[index], items[index], index)\n          onSelectItem(map[index], items[index], index, c)\n          cmp.$$index$$ = index\n          cmp.$$forcingUpdate$$ = true\n          cmp.forceUpdate()\n          cmp.$$forcingUpdate$$ = false\n          return\n        }\n\n        options.expanded = !options.expanded\n        if (options.expanded) onExpand(map[index], items[index], index, c)\n        if (!options.expanded) onContract(map[index], items[index], index, c)\n\n        cmp.$$index$$ = index\n        cmp.$$forcingUpdate$$ = true\n        cmp.forceUpdate()\n        cmp.$$forcingUpdate$$ = false\n      }}\n    />\n  )\n}\n\nexport default functional(Tree)\n\nfunction pad (depth = 0, indentation = 2) {\n  return Array.apply(0, Array((depth + 1) * indentation)).join(' ')\n}\n\nfunction traverse (obj, cfg, depth = 0) {\n  if (Array.isArray(obj)) return {items: obj, map: obj}\n  const map = []\n  let {indentation = 2, labelling = false} = cfg\n  const items = Object.keys(obj).reduce((items, key) => {\n    const {label, value, options = {}} = obj[key]\n    const {expanded, terminate, prefix: itemPrefix = ''} = options\n\n    if ('labelling' in options) { labelling = options.labelling }\n\n    const valueIsObject = Object(value) === value\n    const prefix = valueIsObject && !terminate\n      ? expanded ? '▾ ' : '▸ '\n      : (depth ? '' : '  ')\n\n    const item = pad(depth, indentation) + itemPrefix + (terminate ? ' ' : '') +\n      prefix + key + (labelling ? ': ' + (label || value) : '')\n\n    items.push(item)\n    map.push(obj[key])\n\n    if (expanded && valueIsObject) {\n      const {items: subItems, map: subMap} = traverse(value, cfg, depth + 1)\n      items.push(...subItems)\n      map.push(...subMap)\n    }\n\n    return items\n  }, [])\n\n  return {items, map}\n}\n"]}