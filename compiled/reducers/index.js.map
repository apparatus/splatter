{"version":3,"sources":["../../src/reducers/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import fs from 'fs'\nimport {basename, sep, extname} from 'path'\n\nimport {\n  FOCUS_TAB,\n  FOCUS_PANEL,\n  RECEIVE_CALLSTACK,\n  RECEIVE_BREAKPOINTS,\n  CLEAR_SCOPE,\n  RECEIVE_SCOPE,\n  EXTEND_SCOPE,\n  SET_SCOPE_ITEM,\n  ADD_ITEM_TO_SCOPE,\n  RECEIVE_SOURCE,\n  RECEIVE_SOURCES,\n  SELECT_FILE,\n  SET_FILE_ITEM,\n  SET_EDITOR_LINE,\n  SELECT_FRAME,\n  PAUSE,\n  RESUME,\n  SET_DIMENSIONS,\n  TOGGLE_TOOLTIPS,\n  RECEIVE_STDOUT,\n  RECEIVE_STDERR,\n  CONSOLE_INPUT,\n  CONSOLE_HISTORY,\n  RECEIVE_EVAL_RESULT,\n  RECEIVE_EVAL_ERROR\n} from '../actions'\n\nconst CONSOLE_PREFIXES = {\n  [CONSOLE_INPUT]: '> ',\n  [RECEIVE_EVAL_RESULT]: '⦑ ',\n  [RECEIVE_EVAL_ERROR]: '⨂ ',\n  [RECEIVE_STDERR]: '⨂ ',\n  [RECEIVE_STDOUT]: '  '\n}\n\nexport function tab (state = 'sources', {type, payload}) {\n  if (type !== FOCUS_TAB) return state\n  return (payload + '').toLowerCase()\n}\n\nexport function panel (state = 'console', {type, payload}) {\n  if (type !== FOCUS_PANEL) return state\n  return payload\n}\n\nexport function sources (state = [], {type, payload}) {\n  if (type !== RECEIVE_SOURCES) return state\n  return payload\n}\n\nexport function files (state = [], {type, payload}) {\n  if (type !== RECEIVE_SOURCES) return state\n  const sources = payload.map(s => s.name)\n  const nonNative = sources.filter(s => s && s[0] === sep)\n    .reduce((o, path) => {\n      let next = o\n\n      path.split(sep).filter(Boolean).forEach((segment, ix, arr) => {\n        next[segment] = {value: {}}\n        next[segment].data = {path}\n        if (ix === arr.length - 1) {\n          next[segment].options = {terminate: true}\n        }\n        next = next[segment].value\n      })\n\n      return o\n    }, {})\n\n  const native = {\n    '(core)': {\n      value: sources\n        .filter(s => s && s[0] !== sep)\n        .reduce((o, f) => {\n          o[f] = {\n            value: {},\n            options: {terminate: true},\n            data: {path: f}\n          }\n          return o\n        }, {})\n    }\n  }\n\n  return {...native, ...nonNative}\n}\n\nexport function file (state = '', {type, payload}) {\n  if (type !== SELECT_FILE) return state\n  return payload\n}\n\nexport function fileItem (state = null, {type, payload = state}) {\n  if (type !== SET_FILE_ITEM) return state\n  return payload\n}\n\nexport function scopeItem (state = null, {type, payload = state}) {\n  if (type !== SET_SCOPE_ITEM) return state\n  return payload\n}\n\nexport function editorLine (state = 0, {type, payload}) {\n  if (type !== SET_EDITOR_LINE) return state\n  return {\n    num: payload,\n    idx: payload - 1\n  }\n}\n\nexport function callstack (state = [], {type, payload = []}) {\n  if (type !== RECEIVE_CALLSTACK) return state\n  return payload.map(({\n      functionName,\n      location: {lineNumber: l, columnNumber: c, url}\n    }) =>\n      // we plus one to l because we want human readable (from 1) rather than idx\n      `${functionName || '(anonymous function)'} ${basename(url)}:${l + 1}:${c}`\n  )\n}\n\nexport function frames (state = [], {type, payload = []}) {\n  if (type !== RECEIVE_CALLSTACK) return state\n  return payload\n}\n\nexport function frame (state = {}, {type, payload}) {\n  if (type !== SELECT_FRAME) return state\n  return payload\n}\n\nexport function breaks (state = [], {type, payload}) {\n  if (type !== RECEIVE_BREAKPOINTS) return state\n  return payload\n}\n\nexport function breakpoints (state = [], {type, payload}) {\n  if (type !== RECEIVE_BREAKPOINTS) return state\n  return payload.map(({script_name: name, line}) => `${basename(name)}:${line + 1}`)\n}\n\nexport function scope (state = {}, {type, payload: {area, scope, branch, namespace} = {}}) {\n  if (type === CLEAR_SCOPE) return {}\n\n  if (type === RECEIVE_SCOPE) {\n    return {\n      ...state,\n      [area]: {\n        options: {labelling: false},\n        value: treeify(scope)\n      }\n    }\n  }\n\n  if (type === EXTEND_SCOPE) {\n    // branch is still ref'd in state, altering the branch updates\n    // the state, but we want want to return a new state object to\n    // observe the rule of immutability. If this every breaks (due to branch\n    // being a copy instead of a direct ref, then we'd need to do a deep find\n    // on the state to locate the branch - along with that we'd need to add uids\n    // to every branch))\n    branch.value = treeify(scope)\n    return {...state}\n  }\n\n  if (type === ADD_ITEM_TO_SCOPE) {\n    state[area].value = {\n      [namespace]: Object(scope) === scope\n        ? {\n          label: 'Object',\n          value: !scope.length\n            ? {'« empty »': {options: {labelling: false}}}\n            : treeify(scope)\n        }\n        : {value: scope},\n      ...state[area].value\n    }\n\n    return {...state}\n  }\n\n  return state\n}\n\nexport function source (state = {}, {type, payload}) {\n  if (type !== RECEIVE_SOURCE) return state\n  return payload\n}\n\nexport function paused (state = false, {type}) {\n  if (type !== RESUME && type !== PAUSE) return state\n  return type === PAUSE\n}\n\nexport function layout (state = {}, {type, payload}) {\n  if (type !== SET_DIMENSIONS) return state\n  return payload\n}\n\nexport function tooltips (state = true, {type}) {\n  if (type !== TOGGLE_TOOLTIPS) return state\n  return !state\n}\n\nexport function output (state = {out: '', err: '', all: ''}, {type, payload}) {\n  if (type === CONSOLE_HISTORY) {\n    if (!state.history || !state.history.length) {\n      return state\n    }\n    payload = payload || {step: -1}\n    const {step} = payload\n    let {historyIndex = 0} = state\n    historyIndex += step\n    if (historyIndex > 0) historyIndex = 0\n    if (-historyIndex > state.history.length) historyIndex = -(state.history.length)\n\n    return {\n      ...state,\n      historyIndex\n    }\n  }\n\n  if (type !== RECEIVE_STDOUT && type !== RECEIVE_STDERR &&\n    type !== CONSOLE_INPUT && type !== RECEIVE_EVAL_RESULT &&\n    type !== RECEIVE_EVAL_ERROR) return state\n\n  const {out, err, all, history = []} = state\n\n  const line = type === RECEIVE_EVAL_RESULT\n    ? CONSOLE_PREFIXES[type] + payload + '\\n'\n    : type === RECEIVE_EVAL_ERROR\n      ? '\\n' + CONSOLE_PREFIXES[type] + payload + '\\n'\n      : CONSOLE_PREFIXES[type] + payload\n\n  if (type === CONSOLE_INPUT) {\n    history.push((payload + '').trim())\n    state.historyIndex = 0\n  }\n\n  return {\n    ...state,\n    history,\n    out: (type === RECEIVE_STDOUT) ? CONSOLE_PREFIXES[type] + out + payload : out,\n    err: (type === RECEIVE_STDERR) ? CONSOLE_PREFIXES[type] + err + payload : err,\n    all: all + line\n  }\n}\n\n// utils:\n\nfunction treeify (scope) {\n  return scope.reduce((o, {name, type, value, text, source, className, properties, handle}) => {\n    if (type === 'object') { value = className }\n    if (className === 'Array') {\n      value = 'Array(' + properties.filter(({name}) => !isNaN(name)).length + ')'\n    }\n    if (type === 'string') {\n      value = '\\'' + value + '\\''\n    }\n    value = value || source || text\n    o[name] = properties\n      ? properties.length\n        ? {label: value, value: {}, meta: {handle}}\n        : {label: value, value: {'« empty »': {options: {labelling: false}}}}\n      : {value}\n\n    return o\n  }, {})\n}\n"]}