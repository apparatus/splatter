{"version":3,"sources":["../../src/lib/debug.js"],"names":[],"mappings":"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","file":"debug.js","sourcesContent":["/*\n * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,\n * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\n * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,\n * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING\n * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\nimport fs from 'fs'\nimport {Debugger} from 'yadc'\n\n// important: preserve order\nconst SCOPE_TYPES = ['global', 'local', 'with', 'closure', 'catch', 'block', 'script']\n\nconst PROPERTY_TYPES = {\n  NORMAL: 0,\n  FIELD: 1,\n  CONSTANT: 2,\n  CALLBACKS: 3,\n  HANDLER: 4,\n  INTERCEPTOR: 5,\n  TRANSITION: 6,\n  NONEXISTENT: 7\n}\n\nconst DC_ERROR = Error('disconnected')\n\nexport default () => {\n  let debug\n  let seq = 0\n  const scriptIdToUrl = new Map()\n\n  const scripts = cb => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'scripts',\n      arguments: {\n        types: 4,\n        includeSource: true\n      }\n    }, (err, out) => {\n      if (err) return cb(err)\n      if (!out.res) return cb(Error('no response'))\n      const {res} = out\n      if (!res.body) return cb(Error('no scripts'))\n\n      res.body.forEach(({id, name}) => scriptIdToUrl.set(id, name))\n      cb(null, res.body)\n    })\n  }\n\n  const backtrace = cb => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'backtrace',\n      arguments: {\n        inlineRefs: true,\n        fromFrame: 0,\n        maxStringLength: 10000\n      }\n    }, (err, out) => {\n      if (err) return cb(err)\n      if (!out.res) return cb(Error('no response'))\n      const {res} = out\n      if (res.running) {\n        debug.emit('unpaused')\n      }\n\n      if (!res.body) return cb(Error('no backtrace'))\n      cb(null, res.body)\n    })\n  }\n\n  const breakpoints = cb => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'listbreakpoints'\n    }, (err, out) => {\n      if (err) return cb(err)\n      if (!out.res) return cb(Error('no response'))\n      const {res} = out\n      if (!res.body) return cb(Error('no breakpoints'))\n      res.body.breakpoints = res.body.breakpoints.filter(bp => bp.type === 'scriptName')\n      cb(null, res.body)\n    })\n  }\n\n  const setBreakpoint = ({line, file: target}, cb) => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'setbreakpoint',\n      arguments: {\n        type: 'script', target, line\n      }\n    }, (err, out) => {\n      if (err) return cb(err)\n      if (!out.res) return cb(Error('no response'))\n      const {res} = out\n      if (!res.body) return cb(Error('unable to set breakpoint'))\n      cb(null, res.body)\n    })\n  }\n\n  const clearBreakpoint = (breakpoint, cb) => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'clearbreakpoint',\n      arguments: {\n        type: 'script',\n        breakpoint\n      }\n    }, (err, out) => {\n      if (err) return cb(err)\n      if (!out.res) return cb(Error('no response'))\n      const {res} = out\n      if (!res.body) return cb(Error('unable to unset breakpoint'))\n      cb(null, res.body)\n    })\n  }\n\n  const step = (act, cb = () => {}) => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'continue',\n      arguments: {\n        stepaction: act\n      }\n    }, (err) => {\n      if (err) return cb(err)\n      callstack(cb)\n    })\n  }\n\n  const stepOver = cb => step('next', cb)\n  const stepInto = cb => step('in', cb)\n  const stepOut = cb => step('out', cb)\n\n  const resume = (cb = () => {}) => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'continue'\n    }, (err) => {\n      if (err) return cb(err)\n      cb()\n    })\n  }\n\n  const pause = (cb = () => {}) => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'suspend'\n    }, (err) => {\n      if (err) return cb(err)\n      callstack(cb)\n    })\n  }\n\n  const lookup = ({handles}, cb) => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'lookup',\n      arguments: {\n        handles\n      }\n    }, (err, out) => {\n      if (err) return cb(err)\n      if (!out.res) return cb(Error('no response'))\n      const {res} = out\n      cb(null, res)\n    })\n  }\n\n  const evaluate = ({expression, global, frame, context}, cb) => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    const args = {expression, disable_break: true}\n    if (typeof global !== 'undefined') { args.global = global }\n    if (typeof frame !== 'undefined') { args.frame = frame }\n    if (typeof context !== 'undefined') { args.additional_context = context }\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'evaluate',\n      arguments: args\n    }, (err, out) => {\n      if (err) return cb(err)\n      if (!out.res) return cb(Error('no response'))\n      cb(null, out)\n    })\n  }\n\n  const frameEvaluate = (frame, expression, cb) => evaluate({expression, frame}, cb)\n  const globalEvaluate = (expression, cb) => evaluate({expression, global: true}, cb)\n\n  const scopes = ({callFrameId: frameNumber}, cb) => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    debug.send({\n      seq: ++seq,\n      type: 'request',\n      command: 'scopes',\n      arguments: {\n        number: 0,\n        frameNumber\n      }\n    }, (err, out) => {\n      if (err) return cb(err)\n      if (!out.res) return cb(Error('no response'))\n      const {res} = out\n      if (!res.body) return cb(Error('unable to get scopes'))\n\n      const scopes = res.body.scopes.reduce((o, scope) => {\n        const {type, object: {ref}} = scope\n        if (type > 5) { return o }\n        o[SCOPE_TYPES[type]] = scope\n        scope.context = res.refs.find(({handle}) => handle === ref)\n        return o\n      }, {})\n\n      cb(null, scopes)\n    })\n  }\n\n  const scope = (handles, cb) => {\n    if (!debug.client || !debug.client.writable) return cb(DC_ERROR)\n    // TODO:\n    // __proto__, this, getter/setter functions\n\n    if (!Array.isArray(handles)) handles = [handles]\n\n    handles = handles.map(({object: {ref}}) => ref)\n\n    lookup({handles}, (err, out) => {\n      if (err) {\n        return cb(err)\n      }\n      if (!out.success) {\n        const e = Error('scope lookup error ' + out.message)\n        e.response = out\n        return cb(e)\n      }\n      if (!out.body) {\n        const e = Error('No body in lookup request')\n        e.response = out\n        return cb(e)\n      }\n\n      const {refs} = out\n\n      const objList = handles.map(ref => {\n        const {properties} = out.body[ref]\n\n        if (!properties) { return }\n\n        const props = properties.reduce((a, {name, ref, attributes = 0, propertyType}, i, arr) => {\n          let {\n            type, // e.g. typeof\n            className, // [[Class]] constructor, only non-primitives\n            value,  // only primitives\n            text, // fallback for null/undefined\n            source, // functions\n            properties // only on non-primitives (objects, functions, arrays)\n          } = refs.find(({handle}) => handle === ref)\n\n          const descriptor = {\n            writable: !(attributes & 1 << 0),\n            enumerable: !(attributes & 1 << 1),\n            configurable: !(attributes & 1 << 2)\n          }\n\n          const isPropertyAccessor = attributes === 6 &&\n            propertyType === PROPERTY_TYPES.CALLBACKS &&\n            type === 'undefined'\n\n          // TODO - if getter/setter do an eval in frame to fetch the\n          // get/set function strings (and properties) - since node/v8\n          // doesn't supply the get/set methods via the api\n\n          if (isPropertyAccessor) {\n            type = 'getter/setter'\n            text = '[Getter/Setter]'\n          }\n\n          a.push({name, type, className, value, text, source, properties, descriptor,\n            handle: {\n              object: {ref}\n            }\n          })\n\n          return a\n        }, [])\n\n        return {\n          meta: out.body[ref], props\n        }\n      })\n\n      cb(null, objList.length > 1 ? objList : objList[0])\n    })\n  }\n\n  const callstack = cb => backtrace((err, {frames, totalFrames}) => {\n    if (err) return cb(err)\n    if (totalFrames === 0) { return cb() }\n    if (scriptIdToUrl.size) { return fetch() }\n\n    // populate scripts cache\n    scripts(fetch)\n\n    function fetch () {\n      cb(null, frames.map(({index, func, line, column, receiver}) => ({\n        callFrameId: index,\n        functionName: func.inferredName || func.name,\n        location: {\n          scriptId: func.scriptId,\n          lineNumber: line,\n          columnNumber: column,\n          url: scriptIdToUrl.get(func.scriptId)\n        },\n        contextHandle: {object: receiver}\n      })))\n    }\n  })\n\n  const start = ({port = 5858, host = '127.0.0.1'}, cb) => {\n    debug = new Debugger({port, host})\n    const stdout = __dirname + '/../' + port + '.stdout'\n    const stderr = __dirname + '/../' + port + '.stderr'\n\n    if (fs.existsSync(stdout)) fs.unlinkSync(stdout)\n    if (fs.existsSync(stderr)) fs.unlinkSync(stderr)\n\n    fs.writeFileSync(stdout, '')\n    fs.writeFileSync(stderr, '')\n\n    const stdoutFd = fs.openSync(stdout, 'r')\n    const stderrFd = fs.openSync(stderr, 'r')\n\n    let lastStdoutSize = 0\n    let lastStderrSize = 0\n\n    fs.watch(stdout, (evt) => {\n      if (!/change/.test(evt)) return\n      const {size} = fs.statSync(stdout)\n      const bufferSize = size - lastStdoutSize\n      const buffer = Buffer(bufferSize)\n      lastStdoutSize = size\n      if (!bufferSize) return\n      fs.readSync(stdoutFd, buffer, 0, bufferSize, 'utf8')\n      debug.emit('stdout', buffer + '')\n    })\n\n    fs.watch(stderr, (evt) => {\n      if (!/change/.test(evt)) return\n      const {size} = fs.statSync(stdout)\n      const bufferSize = size - lastStderrSize\n      const buffer = Buffer(bufferSize)\n      lastStderrSize = size\n      if (!bufferSize) return\n      fs.readSync(stderrFd, buffer, 0, bufferSize, 'utf8')\n      debug.emit('stderr', buffer + '')\n    })\n\n    const connected = () => {\n      callstack((err, stack) => {\n        globalEvaluate(`\n          (function () {\n            if (process.wrappedForDebugger) return\n            process.stdout.write = (function(fn) {\n              return function(chunk) {\n                try {\n                  process.mainModule.require('fs').appendFileSync('${stdout}', chunk)\n                } catch (e) {\n                }\n\n                return fn.apply(process.stdout, arguments)\n              }\n            } (process.stdout.write))\n\n            process.stderr.write = (function(fn) {\n              return function(chunk) {\n                try {\n                  process.mainModule.require('fs').appendFileSync('${stderr}', chunk)\n                } catch (e) {\n\n                }\n                return fn.apply(process.stderr, arguments)\n              }\n            } (process.stderr.write))\n\n            process.wrappedForDebugger = true\n          }())\n        `, evalErr => {\n          cb(err || evalErr, stack)\n        })\n\n      })\n    }\n\n    let errorState = false\n    const attempt = () => {\n      if (errorState) return\n      debug.connect(connected)\n      debug.once('error', e => {\n        const {code} = e\n\n        if (code === 'ECONNREFUSED') {\n          setTimeout(attempt, 1000) // TODO cancel previous connect on timeout\n          return\n        }\n\n        errorState = true\n        console.error('error', e)\n      })\n    }\n\n    attempt()\n\n    debug.on('event', (evt) => {\n      if (evt.event === 'break') {\n        debug.emit('break', evt)\n      }\n    })\n\n    return debug\n  }\n\n  return {\n    scripts,\n    start,\n    breakpoints,\n    callstack,\n    resume,\n    pause,\n    scopes,\n    scope,\n    lookup,\n    evaluate,\n    frameEvaluate,\n    globalEvaluate,\n    setBreakpoint,\n    clearBreakpoint,\n    stepOver,\n    stepOut,\n    stepInto\n  }\n}\n"]}